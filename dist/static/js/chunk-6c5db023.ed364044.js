(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c5db023","chunk-664b3c76"],{"0187":function(t,e,i){"use strict";i.d(e,"d",function(){return n}),i.d(e,"b",function(){return a}),i.d(e,"a",function(){return o}),i.d(e,"c",function(){return s}),i.d(e,"e",function(){return l});var r=i("b775");function n(t){return Object(r["a"])({url:"/sys/roles",method:"get",params:t})}function a(t){return Object(r["a"])({url:"/sys/editRole",method:"post",data:t})}function o(t){return Object(r["a"])({url:"/sys/deleteRole",method:"post",data:t})}function s(t){return Object(r["a"])({url:"/sys/getPermissionByRoleId",method:"get",params:{roleId:t}})}function l(t,e,i){return Object(r["a"])({url:"/sys/grantPermissions",method:"post",data:{roleId:t,addPermissionIds:e,deletePermissionIds:i}})}},"26f3":function(t,e,i){"use strict";var r=i("d684"),n=i.n(r);n.a},"42df":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("el-row",{staticStyle:{width:"100%"}},[i("el-col",{attrs:{span:7}},[i("el-card",{attrs:{shadow:"hover"}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[t._v("\n            当前选择角色：\n            "),i("label",[t._v(t._s(t.roleName))])])]),t._v(" "),i("el-scrollbar",[i("el-tree",{directives:[{name:"loading",rawName:"v-loading.body",value:t.loading,expression:"loading",modifiers:{body:!0}}],ref:"tree",staticStyle:{height:"320px"},attrs:{data:t.treeData,"default-expand-all":"","node-key":"id","highlight-current":"","expand-on-click-node":!1},on:{"node-click":t.handleNodeClick}})],1)],1)],1),t._v(" "),i("el-col",{attrs:{span:17}},[i("el-card",{attrs:{shadow:"hover"}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("el-button",{attrs:{type:"primary"},on:{click:t.grantPermission}},[t._v("保存")])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:t.filterPermissionData,"max-height":"650px",border:"",fit:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"highlight-current-row":""},on:{"selection-change":t.selectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"50"}}),t._v(" "),i("el-table-column",{attrs:{label:"请求地址","min-width":"120",prop:"uri"}}),t._v(" "),i("el-table-column",{attrs:{label:"资源名","min-width":"80",prop:"name"}}),t._v(" "),i("el-table-column",{attrs:{label:"描述","min-width":"120",prop:"description"}})],1)],1)],1)],1)],1)},n=[],a=(i("ac6a"),i("c5f6"),i("e37e")),o=i("0187"),s={data:function(){return{treeData:[],permissionData:[],filterPermissionData:[],loading:!1,waitPermissionData:!1,waitRolePermission:!1,waitGrant:!1,currentGroupId:1,existPermission:[],selectedPermission:[]}},created:function(){this.getGroup(),this.getPermissionData()},computed:{listLoading:function(){return this.waitPermissionData||this.waitRolePermission||this.waitGrant}},props:{roleId:Number,roleName:String},watch:{roleId:function(t,e){t&&(this.currentGroupId=1,this.loadPermissionByRoleId())}},methods:{getGroup:function(){var t=this;this.loading=!0,Object(a["d"])().then(function(e){var i=e.data.data;t.formatTree(i),t.loading=!1}).catch()},getPermissionData:function(){var t=this,e={currentPage:1,size:100};this.waitPermissionData=!0,Object(a["c"])(e).then(function(e){var i=e.data.data.records;t.permissionData=i,t.waitPermissionData=!1,t.filterTableData()}).catch()},formatTree:function(t){var e=this;t.forEach(function(i){0==i.parentId?e.treeData.push(i):t.forEach(function(t){t.id==i.parentId&&(t.children||(t.children=[]),t.children.push(i))})})},handleNodeClick:function(t){this.currentGroupId=t.id,this.filterTableData()},filterTableData:function(){var t=this;this.filterPermissionData=this.permissionData.filter(function(e){return 1==t.currentGroupId||e.groupId==t.currentGroupId}),this.authoritiedFunc()},loadPermissionByRoleId:function(){var t=this;this.waitRolePermission=!0,Object(o["c"])(this.roleId).then(function(e){var i=e.data.data;t.existPermission=i,t.waitRolePermission=!1,t.authoritiedFunc()})},authoritiedFunc:function(){var t=this;this.waitRolePermission||this.waitPermissionData||this.$nextTick(function(){var e=[];t.toggleSelection(e),t.filterPermissionData.forEach(function(i){var r=t.existPermission.some(function(t){return t.permissionId==i.id});r&&e.push(i)}),t.toggleSelection(e)})},toggleSelection:function(t){var e=this;t&&t.length?t.forEach(function(t){e.$refs.table.toggleRowSelection(t)}):this.$refs.table.clearSelection()},selectionChange:function(t){this.selectedPermission=JSON.parse(JSON.stringify(t))},grantPermission:function(){var t=this,e=[],i=[],r={};this.existPermission.forEach(function(t){r[t.permissionId]=1});var n={};this.selectedPermission.forEach(function(t){n[t.id]=1,r[t.id]||e.push(t.id)}),this.existPermission.forEach(function(t){n[t.permissionId]||i.push(t.id)}),this.waitGrant=!0,Object(o["e"])(this.roleId,e,i).then(function(e){t.$notify({title:"成功",message:"授权成功",type:"success",duration:2e3}),t.waitGrant=!1,t.loadPermissionByRoleId()}).catch(function(e){t.$notify({title:"失败",message:"授权成功",type:"error"}),t.listLoading=!1})}}},l=s,c=(i("26f3"),i("2877")),d=Object(c["a"])(l,r,n,!1,null,"30df6857",null);e["default"]=d.exports},a5f6:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("el-button",{attrs:{type:"primary"},on:{click:t.addRole}},[t._v("新增")]),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:t.roleList,"max-height":"650px",border:"",fit:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"highlight-current-row":""}},[i("el-table-column",{attrs:{type:"index",width:"50"}}),t._v(" "),i("el-table-column",{attrs:{label:"角色名","min-width":"120",prop:"name"}}),t._v(" "),i("el-table-column",{attrs:{label:"备注","min-width":"80",prop:"remark"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return t.grantPermission(e.row)}}},[t._v("分配权限")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return t.editRole(e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){return t.deleteRole(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),i("el-dialog",{attrs:{title:t.title,visible:t.editDialogVisible,center:"",width:"40%"},on:{"update:visible":function(e){t.editDialogVisible=e},close:t.resetForm}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading.body",value:t.detailLoading,expression:"detailLoading",modifiers:{body:!0}}],ref:"form",attrs:{model:t.form,"label-width":"80px"}},[i("el-form-item",{staticStyle:{width:"47%"},attrs:{label:"角色名",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入角色名"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name","string"===typeof e?e.trim():e)},expression:"form.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"备注",prop:"remark"}},[i("el-input",{attrs:{placeholder:"请输入备注"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark","string"===typeof e?e.trim():e)},expression:"form.remark"}})],1),t._v(" "),"编辑"==t.title?i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(){return t.saveOrUpdateRole()}}},[t._v("更新")]),t._v(" "),i("el-button",{on:{click:function(){return t.cancel()}}},[t._v("取消")])],1):t._e(),t._v(" "),"新增"==t.title?i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(){return t.saveOrUpdateRole()}}},[t._v("保存")]),t._v(" "),i("el-button",{on:{click:function(){return t.cancel()}}},[t._v("取消")])],1):t._e()],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"分配当前角色权限",visible:t.permissionDialogVisible,center:""},on:{"update:visible":function(e){t.permissionDialogVisible=e}}},[i("grant-permission",{attrs:{roleId:t.currentRoleId,roleName:t.currentRoleName}})],1)],1)},n=[],a=(i("7f7f"),i("0187")),o=i("42df"),s={components:{grantPermission:o["default"]},data:function(){return{roleList:[],listLoading:!1,detailLoading:!1,editDialogVisible:!1,permissionDialogVisible:!1,title:"",formModel:{name:void 0,remark:void 0},form:{},currentRoleId:void 0,currentRoleName:void 0}},created:function(){this.loadRoles(),this.resetForm()},watch:{},methods:{loadRoles:function(){var t=this,e={currentPage:1,size:100};this.listLoading=!0,Object(a["d"])(e).then(function(e){var i=e.data.data.records;t.roleList=i,t.listLoading=!1}).catch()},resetForm:function(){this.form=JSON.parse(JSON.stringify(this.formModel))},addRole:function(){this.editDialogVisible=!0,this.title="新增"},editRole:function(t){this.editDialogVisible=!0,this.title="编辑",this.form=JSON.parse(JSON.stringify(t))},saveOrUpdateRole:function(){var t=this;this.detailLoading=!0,Object(a["b"])(this.form).then(function(e){t.$notify({title:"成功",message:"编辑成功",type:"success",duration:2e3}),t.detailLoading=!1,t.editDialogVisible=!1,t.loadRoles()}).catch(function(e){t.$notify({title:"失败",message:"编辑失败",type:"error"}),t.detailLoading=!1})},deleteRole:function(t){var e=this;this.listLoading=!0,Object(a["a"])(t.id).then(function(t){var i=t.data.data;i?(e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),e.listLoading=!1,e.loadRoles()):e.$notify({title:"失败",message:"删除失败",type:"error"})})},cancel:function(){this.editDialogVisible=!1},grantPermission:function(t){var e=this;this.permissionDialogVisible=!0,this.$nextTick(function(){e.currentRoleId=t.id,e.currentRoleName=t.name})}}},l=s,c=i("2877"),d=Object(c["a"])(l,r,n,!1,null,"083125df",null);e["default"]=d.exports},aa77:function(t,e,i){var r=i("5ca1"),n=i("be13"),a=i("79e5"),o=i("fdef"),s="["+o+"]",l="​",c=RegExp("^"+s+s+"*"),d=RegExp(s+s+"*$"),u=function(t,e,i){var n={},s=a(function(){return!!o[t]()||l[t]()!=l}),c=n[t]=s?e(f):o[t];i&&(n[i]=c),r(r.P+r.F*s,"String",n)},f=u.trim=function(t,e){return t=String(n(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(d,"")),t};t.exports=u},c5f6:function(t,e,i){"use strict";var r=i("7726"),n=i("69a8"),a=i("2d95"),o=i("5dbc"),s=i("6a99"),l=i("79e5"),c=i("9093").f,d=i("11e9").f,u=i("86cc").f,f=i("aa77").trim,m="Number",h=r[m],p=h,g=h.prototype,v=a(i("2aeb")(g))==m,b="trim"in String.prototype,y=function(t){var e=s(t,!1);if("string"==typeof e&&e.length>2){e=b?e.trim():f(e,3);var i,r,n,a=e.charCodeAt(0);if(43===a||45===a){if(i=e.charCodeAt(2),88===i||120===i)return NaN}else if(48===a){switch(e.charCodeAt(1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+e}for(var o,l=e.slice(2),c=0,d=l.length;c<d;c++)if(o=l.charCodeAt(c),o<48||o>n)return NaN;return parseInt(l,r)}}return+e};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof h&&(v?l(function(){g.valueOf.call(i)}):a(i)!=m)?o(new p(y(e)),i,h):y(e)};for(var w,I=i("9e1e")?c(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;I.length>_;_++)n(p,w=I[_])&&!n(h,w)&&u(h,w,d(p,w));h.prototype=g,g.constructor=h,i("2aba")(r,m,h)}},d684:function(t,e,i){},e37e:function(t,e,i){"use strict";i.d(e,"d",function(){return n}),i.d(e,"c",function(){return a}),i.d(e,"b",function(){return o}),i.d(e,"a",function(){return s});var r=i("b775");function n(){return Object(r["a"])({url:"/sys/permissionsGroup",method:"get"})}function a(t){return Object(r["a"])({url:"/sys/permissions",method:"get",params:t})}function o(t){return Object(r["a"])({url:"/sys/editPermission",method:"post",data:t})}function s(t){return Object(r["a"])({url:"/sys/deletePermission",method:"post",data:t})}},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);